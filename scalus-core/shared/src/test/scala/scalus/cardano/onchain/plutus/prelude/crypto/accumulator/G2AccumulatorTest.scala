package scalus.cardano.onchain.plutus.prelude.crypto.accumulator

import org.scalatest.funsuite.AnyFunSuite
import scalus.Compile
import scalus.cardano.ledger.ExUnits
import scalus.cardano.onchain.plutus.prelude.List
import scalus.cardano.onchain.plutus.prelude.crypto.accumulator.G2Accumulator.{checkMembership, checkNonMembership}
import scalus.cardano.onchain.plutus.prelude.crypto.accumulator.Poly.getFinalPoly
import scalus.cardano.onchain.plutus.prelude.crypto.bls12_381.G2
import scalus.compiler.Options
import scalus.compiler.sir.TargetLoweringBackend
import scalus.testing.kit.EvalTestKit
import scalus.uplc.PlutusV3
import scalus.uplc.Term.asTerm
import scalus.uplc.builtin.bls12_381.G1Element.g1
import scalus.uplc.builtin.bls12_381.G2Element.g2
import scalus.uplc.builtin.bls12_381.{G1Element, G2Element}

import scala.language.implicitConversions

/** Powers of tau CRS for BLS12-381 bilinear accumulator tests */
@Compile
object CRS {

    /** G1 powers of tau: [g1, tau*g1, tau^2*g1, ...] */
    val powersOfTau: List[G1Element] = List(
      g1"97f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb",
      g1"b0e7791fb972fe014159aa33a98622da3cdc98ff707965e536d8636b5fcc5ac7a91a8c46e59a00dca575af0f18fb13dc",
      g1"acb58c81ae0cae2e9d4d446b730922239923c345744eee58efaadb36e9a0925545b18a987acf0bad469035b291e37269",
      g1"82681717d96c5d63a931c4ee8447ca0201c5951f516a876e78dcbc1689b9c4cf57a00a61c6fd0d92361a4b723c307e2d",
      g1"adb357468d28f2c222024e3745e6197336f10de2e53ee2376bc79e2f0f2313e4509e7512b221d6050364d1df338d1f06",
      g1"a91d6c2d1007eb2def5f8657f831167a98e5969c8f14b628e0ddbab7cfc53601c81df6e969aca7061344d5e8323ad90d",
      g1"829a601a644878b0ac6d06ed7f000c163200909eedbbd32a956485b3c7ae398877c6a3625de36cb44a7e3b1b9f63234d",
      g1"8245ceb0cb176dfae3ef880a936cc8afc5772dc79ade0e25d08aef0ea067c1d355732658daf6e72646c459fafc48f567",
      g1"96903ac25c513f9559a3769678b84169b02ae04706a5f47440995b41c6350dcf18f3f26db06a16184f1b7cba70cb9cca",
      g1"ae095cae1961131f64ea7fc962c9f2a6c1891d6d26c9e7f6d59d8c93aded2e4acdb6290361d2d99bef5f2de4fc9cabc7",
      g1"92e4f628c663ac0e56057cf0758d7b588994f068ebb2d6c371a2b1dde93a3cb59f15725c5a8eb2629b56aa8f5a063c5b",
      g1"8561e4f4b1ae08a470a781debdd1bcf99ff03f05030b74519dd7c38744d20d7304e8444af273bfa34bfaa26a1f878541",
      g1"8cb1cdd886e892bc4a094f776962f237f6d7b7b2c311f54ab76c6c951632bfb7dc31289c1600957c672c98e9383d07fc",
      g1"99ddfd8ee22ab516c6aaaf35eda5c19c942316e37e29ee0baa9b2262bb37d98974b45cd461c811d0ae5a401c0b91a484",
      g1"ab43e5a08c84ce1808c76f46a2ff2d8bcdd8e87f6ebc40854085b10e73745f30e08ced2ed813428ea20818e5a5381138",
      g1"8a07fdfc5041e47cdb84657c00110e4fed3c695a72c87f290457a8b3fd47052b22d043e64cdbe250cef9d6d37cbe4456",
      g1"a6c146801a20d0d7250ebec4b555ca8907eb5397bbf0b0871c39e0f4f411bd5f5a9cc4fcfe3c5d8a8c8b64e3a93514f9",
      g1"b050cba2b8f63114289db8cacb7133b36bba5b21e42528be715f98cf0dd6504741de291b44d42c4368255ffb63ab4bf9",
      g1"a8664a1c55f4d7aebe62f2c043bdb9dd0c9a20725c1dfe8f67824d54f7a2b61af2a8639335c2345abf6cc3f79ddf3718",
      g1"af431ea59e116b70109f7adb4d260f1d05d72973fca24081df4093ad3307867c45fa9f312ab464fa5f2f0c59683c7dad",
      g1"82074b5d969dcc1e852e5100888330f79ae4455eb4520f28bd8321a8869325adf3f527a1e170a2062e459c8b4a81679c",
      g1"b2d1200ac058abe7e08c0efaec3ef93daaddbff2bc3ceae4c40e6ff26858791e5a050f410d33f208bd74367229216e9f",
      g1"aac124c5e0bc9701cb4e51bdaaae57b82af6fb53319cb458c55bb8fffa7315306f19d0e3347baef113f0926c9a86b067",
      g1"846eb53ac2a1ff34c7b4a2e2453e9b6f7f521f4c669dd9536ffef3e74ab04a5215214b51903a514b9789d72537487654",
      g1"98ca0a62a24f81a87e618769076f9b991a9659b1a2d7d66bb54adbca9317ac15a8ce20a4ccd056257854b0715f549f26",
      g1"838bc31ab11d34711236106c83e68362c86610e1631a8f8b940ba63fd18ca343a4fa3f9d2f0f9ed8309efd798e536f93",
      g1"844bf8551e3e4fc0174889355f556bfa5eecc083faebd1262744ad2c224e7f8720134b341c8ea4d534076bb1ef4c5f42",
      g1"a343e4dc3629e8a58dbd1dd5bf1408efc78f9586b0d2ce0bbc8e6716daf4b9551f780ad958eba75ed3609122b9c8a9d9",
      g1"8292754b0f7b4c9481e6b84adfec08e10e47d8146cf037e0c08aa290fc0ae5f631b32e5764862af793103337ef46e171",
      g1"9773cb0a95ed7062f51a300e544d94e6d13430ce97583ddc195192b85beb0929ccc8917fb784e3aafd9da038378e83ca",
      g1"98b61b0cdfd840df81766f02855f8a3fc31e119514b207557c497416b3fb7061895285ac2b3214ba75e37df7d4ae8ee0",
      g1"965d47f577fb917dd4ba73ada45c467bf0d3759854b2a042dcfe10805ec83e3ca228577e3732c180f204c72f24da1ddd",
      g1"a3b02b9d84224715df79bd79790311eed63e602e4463b93e512ad6988ff0212688e09f8d538e1de1a282b8d2c309636b",
      g1"a9e8ae006488eef524a005e21281fd27098b2c0e37777d075333909aa11d92e53923e321622ce35f9f475d5dd8d10cfe",
      g1"87b94efe473f152ea7eb80c2da9e261cd48b65dc43e0eb4b0bf881b609dd25da72b0741831aa3848b7cd3b316a9b212e",
      g1"a448203b1608d867e70495370371742053ca4572e033b9cc2713a000d37fd6389205d2cd11c9bc2dc8e524ea9896c8a6",
      g1"869ec09853df4d8dae8515fed9a9a444e32c1b4159f15b98b76fa4067ed2dbad6bfff7da576d6140a445629b0042fabc",
      g1"90db92b89f9db8996a93616d48f7822dda162e50df0ca41a26045f8d4eee5523fea0d84738f7dbb65c0af76a8c0a2c1d",
      g1"b9520f7a0fe0b96482db4328a3b79d6cb4cb74b1099af35eeb5288d15ef3593aac3f1a5da0d39805473f89f83b149479",
      g1"9621df24094008cf78facc67f829e834af6a9662ccea6ad87f750e65f95d7d80e0d3244957d4816d78a2b75c16e561e9",
      g1"963e17c933edf5903bbd6ba9d24e9c64672f62977db71ec14bb64400431e56f25913551bac8ad4ccef5f758626861981",
      g1"b12eb811f95db9ac60a06c118047e592f45614fd8fa360b6665692efce1983a49b757a9c18379842ca2227f9591d21b9",
      g1"9691b858faa5bf01ab18ea29fa81a3f0e91ba03e373d79090ca84f2354e8324260184837b15aefc41172207107305354",
      g1"8782c0a93ad461e6a970bdba4faf451a48de7d9d2aa532eb8a76cf666db7b2729bcc88f5e445026ef0f77034e080cf72",
      g1"8ceb289ef58efab33a167ffdd1f687689ccdb8cd7dfac5c17692d7329e4aeca2a2961647e4de2c2a12ab7cd8504540db",
      g1"b9eb8e0d7f5b90033456f26b8b486da17d10cb724397e5c06a3276d33fc196b31d887de337f1b7ed0539eed360d229bf"
    )

    /** G2 generator point */
    val g2: G2Element = G2.generator
}

class G2AccumulatorTest extends AnyFunSuite, EvalTestKit {

    test("get final poly") {
        assert(getFinalPoly(List(2, 3)) == List(BigInt(6), 5, 1))
    }

    test("get final poly large") {
        assert(getFinalPoly(List(2, 3, 5, 7, 11)) == List(2310, 2927, 1358, 288, 28, 1))
    }

    test("check membership one element") {
        given compilerOptions: Options = Options(
          targetLoweringBackend = TargetLoweringBackend.SirToUplcV3Lowering,
          generateErrorTraces = true,
          optimizeUplc = true
        )
        val compiled = PlutusV3.compile:
            val crsG1 = CRS.powersOfTau.take(2)
            val accumulator =
                g2"b0f15b32629d02514af939e5b660d27a4db9f84cde5eecfef7db87c056163a9f21925653519cf9972f4b6c115e195baf1439203af99d121fce39ec8eed3fa72a0a31dd537642ab7cb1da52dfbacab1a032c5579aa702a59f1991e9aefae1d9c5"

            val subset =
                List(BigInt("22401154959170154123134540742828377934364533580409315286338474307961"))
            val proof =
                g2"809875352e4cd02184ecd07429198ca87364ca0c4bf895482fb8364662bce1945d33c599b47b7d2b34724f45fa17fab8141afa380d192a9134d7f1238e17475af8f6c862c1eecf9666bb5e00b17461ad33112ef2f8dd9580c178b36300cb6dd8"

            checkMembership(crsG1, accumulator, subset, proof)

        assert(compiled.code)
        val result = compiled.program.term.evaluateDebug
        assert(result.success.term Î±_== true.asTerm)
        assert(result.budget == ExUnits(179614, 4240_621289L))
    }

    test("check membership two elements") {
        val crsG1 = CRS.powersOfTau.take(3)
        val accumulator =
            g2"a9eaead40c09f1ebe1f91eae20828f43b91963058c7612697a97debd6112597dd48dda9760803579434953d5b0938d4819aa1cb23988d7b3ea0a4c71d64c7b4f2b2cf64641f3e7dbadb013b80ef561d3e46b0838b297c64867f173012913fc11"

        val subset = List(
          BigInt("24481988137337345979402196433721828975302737812188733501518683675289"),
          BigInt("11949016871617666658475847346960938230341254399552474158527962314611")
        )

        val proof =
            g2"b76700b0abce4e02d6db4924de6456b75ef1b363eb500edf51cc5fe1d1b5d98f82c64addf79966d0987af855069bafb5019ea2ad533f77ebe01e2e80298284d6996cbdff304f1adac62011273be8863742162b3f73b2100ae4ec35d46941c6e6"

        assert(checkMembership(crsG1, accumulator, subset, proof))
    }

    test("check membership three elements") {
        val crsG1 = CRS.powersOfTau.take(4)
        val accumulator =
            g2"9193c1887649287b712c2451975fddc7a5ff4902c1f6f267a45887fee49aff92d937e848c3620c52184b6439caa564210b1cf99a76d7566f1525c0dfce4164fcd0c627768c8d9c04bbddd23ab448cfa2c22587ebaf1a4832780e8e2d85b35832"

        val subset = List(
          BigInt("24038905256219783303175041908531901856535882621208602552448921926583"),
          BigInt("1571614108127975230209095993153564403708774446988160163848087307519"),
          BigInt("11735491696012837666850221005405205504029708967889959716428146439525")
        )

        val proof =
            g2"99bdb2c73ea6cd3daf1ec82ec2549fa080effb1d5b747106e349f342ab35b8134f62eab0b72a57075b4b4bfcf8e21df801d3b10210069523bde5a7bc8d6644d78a04d85fdbd2b2b810bf4c40b9b8e10e60f2128fb97b455bebcebead449dc899"

        assert(checkMembership(crsG1, accumulator, subset, proof))
    }

    test("check membership five elements") {
        val crsG1 = CRS.powersOfTau.take(6)
        val accumulator =
            g2"a3f377ea89593955979c4de08eae3cb54512bd59ce0b554728f04eb4f951fb4f71e70a20186c50d67c5f20c330e10bf1075332abf365691521f25bc4d17e2a2ad3beea0534391648e38e90fc61c396494fab230efa10bd56e65448f1accb5bf0"

        val subset = List(
          BigInt("18807309260481819398738182499980976500640294208010185044243842436569"),
          BigInt("10256597707778467267175949776758124193683628998159518047244437190245"),
          BigInt("12048957106974617331411250788140940760456248819541655866503651162220"),
          BigInt("6650224964625714968064568029649800443958527113714410364415824604599"),
          BigInt("11735083483361426446085719336533399590913350951085931765584664487011")
        )

        val proof =
            g2"b5bd19004a0d0457e002699522f80d753f6bac6dc6bbea3c2cb8d7b514aeb1a5b263ad576fac8dc8c155fab84ca0922116d1084023cc9f42928003ca9ed6784dab341567ac42cfd5f3a8eae7daad58f89541bc60ba7d6f782c646e11cbaad0fd"

        assert(checkMembership(crsG1, accumulator, subset, proof))
    }

    test("check membership forty five elements") {
        val crsG1 = CRS.powersOfTau
        val accumulator =
            g2"b185fcaa4d0b2b3b7c250aeac3a98bf7d967600058f7ec96fc06f4b8caeee37051f1c5fa5c09106d56fd9a9c5970bae01898b5bfb9a661e1f9f1544bcd29bce20be499fc091e502ce38057780a0455e8bbc5b2b9ed0e9130d7b5c3edfaaf1a04"

        val subset = List(
          BigInt("11413806816543515413261885955626304746962545259869908284006978514041"),
          BigInt("12893541283175862154042991669464816240254937704375999555019217855588"),
          BigInt("6266279994184306071353620777360600485187417035351866523044963141963"),
          BigInt("11207278255020561913385674542640568112556554226603721109668963707256"),
          BigInt("11314682836689446152289993542736940202339388752100301665988734839160"),
          BigInt("12680855042537392966366668927219510922051782008475371330512853428584"),
          BigInt("12580872825849427922301195342716552685289048909908466420794761704047"),
          BigInt("24049350816976229914227377846798618464149711475809546640440069118994"),
          BigInt("24413432713186950612044866229445085822271067442585074363471885317347"),
          BigInt("11842862475536864620369084295077328029284831631726515641995422296424"),
          BigInt("12151802710984347053752356379469256348348349846713806894413503362661"),
          BigInt("14324207325436211114188238191463248491499217143259964719252635562564"),
          BigInt("10261130911704155892210001499567489053252605222758392671700046145647"),
          BigInt("11522414875149055647098629658688085244633362696453442635136220162146"),
          BigInt("11839169838718722291686287116538264160335103484707244220837648033392"),
          BigInt("10578710058192818414517241202865918866118208028110202532296090346098"),
          BigInt("7511464846931760973302952989914732754852477729729060722813499477642"),
          BigInt("22358016250991031430568896051279049744769794557338438616006810085232"),
          BigInt("10257825477787404099612323605576346342560690650423047583009019426678"),
          BigInt("12362025610101831407643901406463295393167825069262528387538348372070"),
          BigInt("10475040070298747094220773117875078666677258520941292828484837926777"),
          BigInt("11519138447694614707179535714209988709695966484226641323499278593132"),
          BigInt("25932272177565973785447353965002248640951848988376765808682995833424"),
          BigInt("4631639229434577028660582071129469059976908975586332173604383025575"),
          BigInt("11580820799220261350754621622585310995764726737616264522457386761472"),
          BigInt("16825823062234101746171194359142373185356294016431265573960808083994"),
          BigInt("23023266843293189024351942526704045068833945415990740190736974980366"),
          BigInt("11944462809395148729230265002602075439900641443886613406380144685434"),
          BigInt("181726112378601142966133945952715518448837281239155472268995454815"),
          BigInt("7134713297465509732940945850465343506134185375084116821920664855896"),
          BigInt("12466921641898213546168683882456330261201275159491203701776716495206"),
          BigInt("19654308765098044721949523477601792078383805133958924872880275805285"),
          BigInt("11316733315083885145568110216459533891894645933455514671218025788272"),
          BigInt("17648889018469906317859245794537053944393120513685719720541876684505"),
          BigInt("12151404265651226687861837292894183381552031691824170882007318230899"),
          BigInt("12153048100401693532403380251170783229169793970346897232672161294439"),
          BigInt("11313835980215991046908139127436341830278010472866468649084319529318"),
          BigInt("11309722244226388798240329192084972224268802265233684281870371614058"),
          BigInt("12577173685930043114470177189557165049834309990071312442295062129519"),
          BigInt("1422691244823513311263988338699610229998353139897607927114447369501"),
          BigInt("13408801060188848158472796848824351190882202748400448341709169373445"),
          BigInt("12678807796971519622875956070160927447986020413286035351675385310053"),
          BigInt("12474753964490306143616627537698684873528391476893822573897048876661"),
          BigInt("2730849852259848144235569142947459726185703858996502852003615605928"),
          BigInt("15414948375613490854553976578984648433126684982971588684191685446556")
        )

        val proof =
            g2"b0c2ead18e582d3b4a39e06afaf32615d356215c4d80743920adbaefddf7bef00c3507e78743d43a600c9eac833fdf470c75456a845da33996237866b3e274c70650bcfb85270ca415f64123f6da13eaed668e9b0f51b45617fc5833d0337475"

        assert(checkMembership(crsG1, accumulator, subset, proof))
    }

    test("check non membership one elements") {
        val crsG1 = CRS.powersOfTau.take(2)
        val crsG2 = CRS.g2
        val accumulator =
            g2"a82b83da0a22649c8228cb7fa581813f6b110ab422e4876d57cb074c952ef95efe5c929a8c6c0a87c33c47d58797f65e06a024473d2271d7205d0b5bd85ce2b6ed152150a1575f5b18d60e3e01762ea1d18374cceac551c622bac144f85f66e4"

        val disjointSet = List(BigInt("55"))

        val proof = (
          g1"89f56e5654cfc32a30085d18f4c1a64bdf397b80369ce0b27d98f1431a82a1f625cb2595c737dd0885ddbe8ea0839458",
          g2"87fa45b2f91ceb469308014c86941e1ab4112cd3658544b828e89d5254d0e396148543add5966146b8b39dafe321ba0705a311ed9d4209807339759a53aa2a8367820c41ee009a5a94707f7ea30e516aac804fa314d9854af83f1c73f0f64650"
        )

        assert(checkNonMembership(crsG1, crsG2, accumulator, disjointSet, proof))
    }

    test("check non membership three elements") {
        val crsG1 = CRS.powersOfTau.take(4)
        val crsG2 = CRS.g2
        val accumulator =
            g2"909b52c4c6c3c7f052524a9f6b5d72d6358159ad6ee7bb4fc083c03305abbc35b89685b14a0c6c531c262ce69b583ca90e0c20e66ae74a079828a446cb9ebc0644901ed5886fdb495628d22a7866bd98061381707f543bdd5b4004d2e977d541"

        val disjointSet = List(BigInt("55"), BigInt("55"), BigInt("55"))

        val proof = (
          g1"8b4a020d04fd9a2fd3effb0a63c914d8b14b7e28574549511c621e5166d39093433601bd06de7b165044b20329b00276",
          g2"8f7982b01230da7b7dfe9019b0878068ef6187b7cf4cb44fabf4a658f73ac809adf0a4f0ca2c73a87f498e3122e95c8701b0f43892d5d7b2cd947c1d0c0350126957e358505dbaf268306f2a550483e2ae98a2216c38025cf6d0f1accbb16b46"
        )

        assert(checkNonMembership(crsG1, crsG2, accumulator, disjointSet, proof))
    }

    test("check non membership five elements") {
        val crsG1 = CRS.powersOfTau.take(6)
        val crsG2 = CRS.g2
        val accumulator =
            g2"a4e24a3741d3f6d22d62e896d80d5eaaaf6820109c868903377de1a75268c7b3e6d08aa4dab2d3d81ebac22b05f054b00005885c9f4516ca78c33bf158e401d44acc363eba20ab2b6c6c5125e7c50914d1497321f217ef125782ad43c2ef93f0"

        val disjointSet = List(BigInt("55"), BigInt("55"), BigInt("55"), BigInt("55"), BigInt("55"))

        val proof = (
          g1"800c702b3ff19f393b705dec27b6a728576c7358a4295e545156b26358d2a9cf27b8ef7ab8335ea535aaa8d2d53e0724",
          g2"b421e762c8ea34b4725f78adb88acf34812661291a16b76fb705aa7407318e3d50bb0717c0daf104180c60e1bbede6471727bd91ccdf90db30ba1e67abaf27f9043bee44293f41e909dd327d0582484e5b0db8c05b597f8c4792894fb5ff7b31"
        )

        assert(checkNonMembership(crsG1, crsG2, accumulator, disjointSet, proof))
    }

    test("getFinalPoly 100 elements budget") {
        given compilerOptions: Options = Options(
          targetLoweringBackend = TargetLoweringBackend.SirToUplcV3Lowering,
          generateErrorTraces = true,
          optimizeUplc = true
        )
        val compiled = PlutusV3.compile:
            getFinalPoly(
              List(
                BigInt("1000000000000000000"),
                BigInt("2000000000000000000"),
                BigInt("3000000000000000000"),
                BigInt("4000000000000000000"),
                BigInt("5000000000000000000"),
                BigInt("6000000000000000000"),
                BigInt("7000000000000000000"),
                BigInt("8000000000000000000"),
                BigInt("9000000000000000000"),
                BigInt("10000000000000000000"),
                BigInt("11000000000000000000"),
                BigInt("12000000000000000000"),
                BigInt("13000000000000000000"),
                BigInt("14000000000000000000"),
                BigInt("15000000000000000000"),
                BigInt("16000000000000000000"),
                BigInt("17000000000000000000"),
                BigInt("18000000000000000000"),
                BigInt("19000000000000000000"),
                BigInt("20000000000000000000"),
                BigInt("21000000000000000000"),
                BigInt("22000000000000000000"),
                BigInt("23000000000000000000"),
                BigInt("24000000000000000000"),
                BigInt("25000000000000000000"),
                BigInt("26000000000000000000"),
                BigInt("27000000000000000000"),
                BigInt("28000000000000000000"),
                BigInt("29000000000000000000"),
                BigInt("30000000000000000000"),
                BigInt("31000000000000000000"),
                BigInt("32000000000000000000"),
                BigInt("33000000000000000000"),
                BigInt("34000000000000000000"),
                BigInt("35000000000000000000"),
                BigInt("36000000000000000000"),
                BigInt("37000000000000000000"),
                BigInt("38000000000000000000"),
                BigInt("39000000000000000000"),
                BigInt("40000000000000000000"),
                BigInt("41000000000000000000"),
                BigInt("42000000000000000000"),
                BigInt("43000000000000000000"),
                BigInt("44000000000000000000"),
                BigInt("45000000000000000000"),
                BigInt("46000000000000000000"),
                BigInt("47000000000000000000"),
                BigInt("48000000000000000000"),
                BigInt("49000000000000000000"),
                BigInt("50000000000000000000"),
                BigInt("51000000000000000000"),
                BigInt("52000000000000000000"),
                BigInt("53000000000000000000"),
                BigInt("54000000000000000000"),
                BigInt("55000000000000000000"),
                BigInt("56000000000000000000"),
                BigInt("57000000000000000000"),
                BigInt("58000000000000000000"),
                BigInt("59000000000000000000"),
                BigInt("60000000000000000000"),
                BigInt("61000000000000000000"),
                BigInt("62000000000000000000"),
                BigInt("63000000000000000000"),
                BigInt("64000000000000000000"),
                BigInt("65000000000000000000"),
                BigInt("66000000000000000000"),
                BigInt("67000000000000000000"),
                BigInt("68000000000000000000"),
                BigInt("69000000000000000000"),
                BigInt("70000000000000000000"),
                BigInt("71000000000000000000"),
                BigInt("72000000000000000000"),
                BigInt("73000000000000000000"),
                BigInt("74000000000000000000"),
                BigInt("75000000000000000000"),
                BigInt("76000000000000000000"),
                BigInt("77000000000000000000"),
                BigInt("78000000000000000000"),
                BigInt("79000000000000000000"),
                BigInt("80000000000000000000"),
                BigInt("81000000000000000000"),
                BigInt("82000000000000000000"),
                BigInt("83000000000000000000"),
                BigInt("84000000000000000000"),
                BigInt("85000000000000000000"),
                BigInt("86000000000000000000"),
                BigInt("87000000000000000000"),
                BigInt("88000000000000000000"),
                BigInt("89000000000000000000"),
                BigInt("90000000000000000000"),
                BigInt("91000000000000000000"),
                BigInt("92000000000000000000"),
                BigInt("93000000000000000000"),
                BigInt("94000000000000000000"),
                BigInt("95000000000000000000"),
                BigInt("96000000000000000000"),
                BigInt("97000000000000000000"),
                BigInt("98000000000000000000"),
                BigInt("99000000000000000000"),
                BigInt("100000000000000000000")
              )
            )
        val result = compiled.program.term.evaluateDebug
        assert(result.budget == ExUnits(93_880_006, 23_725_145_177L))
    }
}
